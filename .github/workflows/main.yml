name: Free RDP via Ngrok
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: ğŸ§° Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù…
      run: |
        choco install ngrok -y
        Set-ExecutionPolicy Bypass -Scope Process -Force
        net user RDP "H6TZ,%U$bI79" /add
        net localgroup administrators RDP /add
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

    - name: ğŸŒ ØªØ´ØºÙŠÙ„ Ngrok TCP Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 3389
      env:
        NGROK_AUTHTOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
      run: |
        ngrok config add-authtoken $env:NGROK_AUTHTOKEN
        Start-Process -FilePath "ngrok" -ArgumentList "tcp 3389 --log=stdout > ngrok.log" -WindowStyle Hidden
        Start-Sleep -Seconds 15

    - name: ğŸ“¡ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
      run: |
        $tunnel = (Invoke-RestMethod -Uri "http://127.0.0.1:4040/api/tunnels").tunnels.public_url
        echo "ğŸ”— **RDP Address:** $tunnel"
        echo "ğŸ‘¤ **Username:** RDP"
        echo "ğŸ”‘ **Password:** H6TZ,%U$bI79"
        echo "============================="

        $address = $tunnel -replace "tcp://", ""
        $rdpContent = @"
full address:s:$address
username:s:RDP
"@
        $rdpPath = "C:\Users\Public\Desktop\FreeRDP.rdp"
        $rdpContent | Out-File -Encoding ASCII $rdpPath

        Compress-Archive -Path $rdpPath -DestinationPath C:\RDP_File.zip

    - name: ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù RDP Ù„Ù„ØªØ­Ù…ÙŠÙ„
      uses: actions/upload-artifact@v4
      with:
        name: Free-RDP-File
        path: C:\RDP_File.zip

    - name: ğŸ•“ Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø­ÙŠØ©
      run: |
        Write-Host "âœ… RDP Ø¬Ø§Ù‡Ø² Ø§Ù„Ø¢Ù†!"
        Write-Host "ğŸ“± Ø§Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Microsoft Remote Desktop Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ"
        Write-Host "ğŸ“Œ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±"
        while ($true) { Start-Sleep -Seconds 300 }
